<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Callback hell</title>
</head>
<body>
    <script src="shri-async-hw.js"></script>

    <script>
        const {
            AsyncArray,
            add,
            mod,
            equal
        } = Homework;

        const cb = (res) => {
            console.log(new Date().toLocaleString());
            console.log(res);
        }

        const getOddSum = (array, cb) => {
            let summ = 0;

            (async function iterate() {
                const value = await new Promise ((resolve, reject) => (array.pop((res) => resolve(res))));
                if (value) {

                    iterate();
                    const moddedValue = await new Promise ((resolve, reject) => (mod(value, 2, (res) => resolve(res))));

                    if (moddedValue) {
                        summ = await new Promise ((resolve, reject) => (add(summ, value, (res) => resolve(res))));
                    }
                } else {
                    cb(summ);
                }
            })();
        }

        a = new AsyncArray(Array(1000).fill(2));
        console.log(new Date().toLocaleString());
        getOddSum(a, cb);
    
    </script>
</body>
</html>